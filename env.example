# Copy to ".env" locally (do NOT commit secrets)
# All variables are optional; defaults match docker-compose.yml unless noted.

# --------------------------
# OpenSearch
# --------------------------
# Initial admin password (only used when security plugin enabled).
OPENSEARCH_INITIAL_ADMIN_PASSWORD=StrongPassword123!
# JVM heap for OpenSearch.
OPENSEARCH_JAVA_OPTS="-Xms16g -Xmx16g"

# --------------------------
# Postgres
# --------------------------
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=document_storage
# Server connection limit (also used as default for storage pool max).
POSTGRES_MAX_CONNECTIONS=1000

# --------------------------
# PgBouncer
# --------------------------
# Backend Postgres connection settings used by PgBouncer.
DB_HOST=postgres
DB_PORT=5432
DB_NAME=document_storage
DB_USER=postgres
DB_PASSWORD=postgres
# Pooling mode: session | transaction | statement
POOL_MODE=transaction
# Pool sizing.
MIN_POOL_SIZE=10
DEFAULT_POOL_SIZE=20
RESERVE_POOL_SIZE=10
MAX_CLIENT_CONN=1000
# Auth type: scram-sha-256 | md5 | trust
AUTH_TYPE=scram-sha-256
# Close idle server connections after this many seconds.
SERVER_IDLE_TIMEOUT=30

# --------------------------
# RabbitMQ
# --------------------------
RABBITMQ_DEFAULT_USER=guest
RABBITMQ_DEFAULT_PASS=guest

# --------------------------
# RustFS (S3-compatible storage)
# --------------------------
RUSTFS_ACCESS_KEY=rustfsadmin
RUSTFS_SECRET_KEY=rustfsadmin
RUSTFS_VOLUMES=/data/rustfs{0...3}
RUSTFS_ADDRESS=0.0.0.0:9000
RUSTFS_CONSOLE_ADDRESS=0.0.0.0:9001
RUSTFS_CONSOLE_ENABLE=true
RUSTFS_EXTERNAL_ADDRESS=:9000
RUSTFS_CORS_ALLOWED_ORIGINS=*
RUSTFS_CONSOLE_CORS_ALLOWED_ORIGINS=*
RUSTFS_OBS_LOGGER_LEVEL=info
RUSTFS_TLS_PATH=/opt/tls
RUSTFS_OBJECT_CACHE_ENABLE=true
RUSTFS_OBJECT_CACHE_TTL_SECS=300

# --------------------------
# Document Storage (document-storage)
# --------------------------
STORAGE_SERVICE_NAME=document-storage
STORAGE_ENVIRONMENT=dev
STORAGE_LOG_LEVEL=INFO
# local | s3
STORAGE_STORAGE_BACKEND=s3
STORAGE_STORAGE_PATH=/data/documents
STORAGE_S3_ENDPOINT=http://rustfs:9000
STORAGE_S3_BUCKET=documents
STORAGE_S3_ACCESS_KEY=rustfsadmin
STORAGE_S3_SECRET_KEY=rustfsadmin
STORAGE_S3_REGION=us-east-1
STORAGE_DB_URL=postgresql://postgres:postgres@pgbouncer:5432/document_storage
# Connection pool for document-storage.
STORAGE_DB_POOL_MIN=1
STORAGE_DB_POOL_MAX=1000
STORAGE_MAX_FILE_SIZE_MB=100
# Comma-separated allow-list.
STORAGE_ALLOWED_CONTENT_TYPES=text/plain,text/markdown,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.presentationml.presentation,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,text/html,application/xhtml+xml,text/xml,application/xml

# --------------------------
# Doc Processor (doc-processor)
# --------------------------
PROCESSOR_SERVICE_NAME=doc-processor
PROCESSOR_ENVIRONMENT=dev
PROCESSOR_LOG_LEVEL=INFO
# Chunking params.
PROCESSOR_CHUNK_SIZE_CHARS=2000
PROCESSOR_CHUNK_OVERLAP_CHARS=200
# VLM extraction (Docling)
PROCESSOR_VLM_BASE_URL=http://vllm-docling:8123/v1
PROCESSOR_VLM_MODEL=ibm-granite/granite-docling-258M
PROCESSOR_VLM_TIMEOUT_S=300
PROCESSOR_MAX_PAGES=50
PROCESSOR_MAX_IMAGE_SIDE_PX=2000
# Downstream dependencies.
PROCESSOR_STORAGE_URL=http://document-storage:8081
PROCESSOR_STORAGE_TIMEOUT_S=30
PROCESSOR_RETRIEVAL_URL=http://retrieval:8080
PROCESSOR_RETRIEVAL_TIMEOUT_S=30

# --------------------------
# Ingestion Worker (doc-processor worker)
# --------------------------
WORKER_LOG_LEVEL=INFO
WORKER_QUEUE=ingestion.tasks
WORKER_RETRY_QUEUE=ingestion.tasks.retry
WORKER_DLQ_QUEUE=ingestion.tasks.dlq
WORKER_RABBIT_URL=amqp://guest:guest@rabbitmq:5672/
# Retry and backoff.
WORKER_MAX_ATTEMPTS=3
WORKER_RETRY_TTL_MS=60000
WORKER_PREFETCH=10
WORKER_METRICS_PORT=8082
# Downstream dependencies.
WORKER_DOC_PROCESSOR_URL=http://doc-processor:8082
WORKER_DOC_PROCESSOR_TIMEOUT_S=300
WORKER_STORAGE_URL=http://document-storage:8081
WORKER_STORAGE_TIMEOUT_S=30
WORKER_RETRIEVAL_URL=http://retrieval:8080
WORKER_RETRIEVAL_TIMEOUT_S=30

# --------------------------
# Retrieval Service (service)
# --------------------------
RAG_SERVICE_NAME=hybrid-retrieval
RAG_ENVIRONMENT=dev
RAG_LOG_LEVEL=INFO
# OpenSearch (BM25)
RAG_OS_URL=http://opensearch:9200
RAG_OS_INDEX_ALIAS=rag_chunks
RAG_OS_INDEX_PREFIX=rag_chunks_v
# Qdrant (Vector)
RAG_QDRANT_URL=http://qdrant:6333
RAG_QDRANT_COLLECTION=rag_chunks_bge_m3_1024
RAG_VECTOR_SIZE=1024
# cosine | dot | euclid
RAG_VECTOR_DISTANCE=cosine
# Weights and fusion.
RAG_WEIGHT_BM25=0.5
RAG_WEIGHT_VECTOR=0.5
RAG_RRF_K=60
RAG_FUSION_ALPHA=0.5
# Top-k defaults.
RAG_DEFAULT_TOP_K=10
RAG_BM25_TOP_K=10
RAG_VECTOR_TOP_K=10
# Chunking/indexing
RAG_CHUNK_MAX_TOKENS=512
RAG_CHUNK_OVERLAP_TOKENS=50
RAG_MAX_CHUNKS_PER_DOC=1000
RAG_ENABLE_PAGE_DEDUPLICATION=false
RAG_ENABLE_PARENT_PAGE_RETRIEVAL=false
# Embeddings
# Provider: http | mock
RAG_EMBEDDING_PROVIDER=http
RAG_EMBEDDING_URL=http://infinity-embed:7997/embeddings
RAG_EMBEDDING_MODEL=BAAI/bge-m3
RAG_EMBEDDING_TIMEOUT_S=30
RAG_EMBEDDING_BATCH_SIZE=64
RAG_EMBEDDING_CONCURRENCY=4
# Contextual headers for embeddings (requires reindex).
RAG_EMBEDDING_CONTEXTUAL_HEADERS_ENABLED=false
RAG_EMBEDDING_CONTEXTUAL_HEADERS_MAX_CHARS=400
# Rerank
RAG_RERANK_URL=http://infinity-rerank:7998/rerank
RAG_RERANK_MODEL=BAAI/bge-reranker-v2-m3
RAG_RERANK_TIMEOUT_S=10
# off | on | auto
RAG_RERANK_MODE=auto
RAG_RERANK_MAX_CANDIDATES=50
RAG_RERANK_AUTO_MIN_QUERY_TOKENS=6
RAG_RERANK_AUTO_MIN_INTERSECTION=2
# Observability
RAG_OTEL_ENABLED=false
RAG_OTEL_SERVICE_NAME=retrieval
# Redact mode for URIs in logs: none | hash
RAG_REDACT_URI_MODE=hash

# --------------------------
# Gate (API Gateway)
# --------------------------
GATE_SERVICE_NAME=gate
GATE_ENVIRONMENT=dev
GATE_LOG_LEVEL=INFO
GATE_CORS_ALLOW_ORIGINS=*
GATE_STORAGE_URL=http://document-storage:8081
GATE_STORAGE_TIMEOUT_S=30
GATE_DOC_PROCESSOR_URL=http://doc-processor:8082
GATE_DOC_PROCESSOR_TIMEOUT_S=300
GATE_RETRIEVAL_URL=http://retrieval:8080
GATE_RETRIEVAL_TIMEOUT_S=30
GATE_RABBIT_URL=amqp://guest:guest@rabbitmq:5672/
GATE_RABBIT_QUEUE=ingestion.tasks
# Query behavior.
GATE_TOP_K=10
GATE_MAX_CONTEXT_CHARS=12000
GATE_MULTI_QUERY_ENABLED=false
GATE_MULTI_QUERY_MAX_QUERIES=4
GATE_MULTI_QUERY_TOP_K_MULTIPLIER=2
GATE_MULTI_QUERY_RRF_K=60
GATE_TWO_PASS_ENABLED=false
GATE_TWO_PASS_MIN_UNIQUE_DOCS=3
GATE_TWO_PASS_HINT_MAX_TERMS=30
GATE_SEGMENT_STITCHING_ENABLED=false
GATE_SEGMENT_STITCHING_GROUP_BY_PAGE=true
GATE_SEGMENT_STITCHING_MAX_CHUNKS=6
GATE_BM25_ANCHOR_ENABLED=false
GATE_BM25_ANCHOR_TOP_K=20
GATE_BM25_ANCHOR_RRF_K=60
# Retrieval mode: hybrid | bm25 | vector
GATE_RETRIEVAL_MODE=hybrid
# LLM settings
GATE_LLM_PROVIDER=openai_compat
GATE_LLM_BASE_URL=https://inference.asicloud.cudos.org/v1
GATE_LLM_MODEL=openai/gpt-oss-120bt
GATE_LLM_API_KEY=
GATE_LLM_TIMEOUT_S=60

# --------------------------
# Agent Search
# --------------------------
AGENT_GATE_URL=http://rag-gate:8090
AGENT_GATE_TIMEOUT_S=30
AGENT_LLM_BASE_URL=https://inference.asicloud.cudos.org/v1
AGENT_LLM_MODEL=openai/gpt-oss-120bt
AGENT_LLM_API_KEY=
AGENT_LLM_TIMEOUT_S=60

# --------------------------
# Deep Research
# --------------------------
DEEP_GATE_URL=http://rag-gate:8090
DEEP_GATE_TIMEOUT_S=30
DEEP_LLM_PROVIDER=mock
DEEP_LLM_BASE_URL=https://inference.asicloud.cudos.org/v1
DEEP_LLM_MODEL=meta-llama/llama-3.3-70b-instruct
DEEP_LLM_API_KEY=
DEEP_LLM_TEMPERATURE=0.2
DEEP_MAX_ITERATIONS=6
DEEP_TOP_K=10
DEEP_RERANK=true
# hybrid | bm25 | vector
DEEP_RETRIEVAL_MODE=hybrid

# --------------------------
# Observability / Exporters
# --------------------------
# Postgres exporter DSN
DATA_SOURCE_NAME=postgresql://postgres:postgres@postgres:5432/document_storage?sslmode=disable
# Allow Grafana signups.
GF_USERS_ALLOW_SIGN_UP=false
GF_SECURITY_ADMIN_USER=admin
GF_SECURITY_ADMIN_PASSWORD=admin

# --------------------------
# GPU / Model runtime
# --------------------------
# For vLLM / Infinity on GPU hosts.
NVIDIA_VISIBLE_DEVICES=all
NVIDIA_DRIVER_CAPABILITIES=compute,utility
# HuggingFace cache for vLLM.
HF_HOME=/root/.cache/huggingface

# --------------------------
# Misc
# --------------------------
RUST_LOG=warn,actix_web=warn
